{
  "hash": "93188d3a0906e402de9de584cecc599b",
  "result": {
    "engine": "knitr",
    "markdown": "---\nengine: knitr\ntitle: Base types\n---\n\n## Learning objectives:\n\n- Understand what OOP means--at the very least for R\n- Know how to discern an object's nature--base or OO--and type\n\n![John Chambers, creator of S programming language](images/base_types/john_chambers_about_objects.png)\n\n<details>\n<summary>Session Info</summary>\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"DiagrammeR\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nutils::sessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> R version 4.5.1 (2025-06-13)\n#> Platform: aarch64-apple-darwin20\n#> Running under: macOS Sequoia 15.7.1\n#> \n#> Matrix products: default\n#> BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib \n#> LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1\n#> \n#> locale:\n#> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n#> \n#> time zone: Europe/London\n#> tzcode source: internal\n#> \n#> attached base packages:\n#> [1] stats     graphics  grDevices utils     datasets  methods   base     \n#> \n#> other attached packages:\n#> [1] DiagrammeR_1.0.11\n#> \n#> loaded via a namespace (and not attached):\n#>  [1] digest_0.6.37      RColorBrewer_1.1-3 fastmap_1.2.0      xfun_0.53         \n#>  [5] magrittr_2.0.4     glue_1.8.0         knitr_1.50         htmltools_0.5.8.1 \n#>  [9] rmarkdown_2.30     cli_3.6.5          visNetwork_2.1.4   compiler_4.5.1    \n#> [13] tools_4.5.1        evaluate_1.0.5     yaml_2.3.10        rlang_1.1.6       \n#> [17] jsonlite_2.0.0     htmlwidgets_1.6.4\n```\n\n\n:::\n:::\n\n\n</details>\n\n\n## Why OOP is hard in R\n\n- Multiple OOP systems exist: S3, R6, S4, and (now/soon) S7.\n- Multiple preferences: some users prefer one system; others, another.\n- R's OOP systems are different enough that prior OOP experience may not transfer well.\n\n[![XKCD 927](images/base_types/standards.png)](https://xkcd.com/927/)\n\n\n## OOP: Big Idea - Polymorphism\n\nFunction has a single interface (outside), but contains (inside) several class-specific implementations.\n\n::: {.cell}\n\n```{.r .cell-code}\n# imagine a function with object x as an argument\n# from the outside, users interact with the same function\n# but inside the function, there are provisions to deal with objects of different classes\nsome_function <- function(x) {\n  if is.numeric(x) {\n    # implementation for numeric x\n  } else if is.character(x) {\n    # implementation for character x\n  } ...\n}\n```\n:::\n\n\n## OOP: Big Idea - Polymorphism example\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data frame, with columns of different types\nsummary(attenu[, 1:4])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>      event            mag           station         dist       \n#>  Min.   : 1.00   Min.   :5.000   117    :  5   Min.   :  0.50  \n#>  1st Qu.: 9.00   1st Qu.:5.300   1028   :  4   1st Qu.: 11.32  \n#>  Median :18.00   Median :6.100   113    :  4   Median : 23.40  \n#>  Mean   :14.74   Mean   :6.084   112    :  3   Mean   : 45.60  \n#>  3rd Qu.:20.00   3rd Qu.:6.600   135    :  3   3rd Qu.: 47.55  \n#>  Max.   :23.00   Max.   :7.700   (Other):147   Max.   :370.00  \n#>                                  NA's   : 16\n```\n\n\n:::\n:::\n\n\n## OOP: Big Idea - Polymorphism example\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# statistical model\nlin_fit <- lm(mpg ~ hp, data = mtcars)\nsummary(lin_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> \n#> Call:\n#> lm(formula = mpg ~ hp, data = mtcars)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -5.7121 -2.1122 -0.8854  1.5819  8.2360 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 30.09886    1.63392  18.421  < 2e-16 ***\n#> hp          -0.06823    0.01012  -6.742 1.79e-07 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.863 on 30 degrees of freedom\n#> Multiple R-squared:  0.6024,\tAdjusted R-squared:  0.5892 \n#> F-statistic: 45.46 on 1 and 30 DF,  p-value: 1.788e-07\n```\n\n\n:::\n:::\n\n\n## OOP: Big Idea - Encapsulation\n\n2. **Encapsulation.** Function \"encapsulates\"--that is, encloses in an inviolate capsule--both data and how it acts on data. The user doesnâ€™t need to worry about details of an object because they are encapsulated behind a standard interface.\n\n<details>\n<summary>REST API comparison</summary>\nThink of a REST API: a client interacts with with an API only through a set of discrete endpoints (i.e., things to get or set), but the server does not otherwise give access to its internal workings or state. Like with an API, this creates a separation of concerns: OOP functions take inputs and yield results; users only consume those results.\n</details>\n\n## Objects have class\n\n- Class defines:\n  - Method (i.e., what can be done with object)\n  - Fields (i.e., data that defines an instance of the class)\n- Objects are an instance of a class\n\n> A class defines what an object *is* and methods describe what that object can *do*.\n\n## Class is inherited\n\n- Class is defined:\n  - By an object's class (e.g., ordered factor)\n  - By the parent of the object's class (e.g., factor)\n- Inheritance matters for method dispatch\n  - If a method is defined for an object's class, use that method\n  - If an object doesn't have a method, use the method of the parent class\n  - The process of finding a method, is called dispatch\n\n## OOP in R: Two Paradigms\n\n**1. Encapsulated OOP**\n\n- Methods belong to objects or classes\n- Method calls typically look like `object.method(arg1, arg2)`\n\n<details>\n- Calls communicate encapsulation, since form follows function\n  - Form: `object.method(arg1, arg2)`\n  - Function: for `object`, apply `method` for `object`'s class with arguments `arg1` and `arg2`\n</details>\n\n## OOP in R: Two Paradigms\n\n**2. Functional OOP**\n\n- Methods belong to \"generic\" functions\n- From the outside, look like regular functions: `generic(object, arg2, arg3)`\n- From the inside, components are also functions\n\n## Concept Map\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"DiagrammeR html-widget html-fill-item\" id=\"htmlwidget-125de4ba22f99b167c94\" style=\"width:960px;height:480px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-125de4ba22f99b167c94\">{\"x\":{\"diagram\":\"\\ngraph TB\\n\\nOOP --> encapsulated_OOP\\nOOP --> functional_OOP\\n\\nfunctional_OOP --> S3\\nfunctional_OOP --> S4\\n\\nencapsulated_OOP --> R6\\nencapsulated_OOP --> RC\\n\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n<details>\n<summary>Mermaid code</summary>\n\n::: {.cell}\n\n```{.r .cell-code}\nDiagrammeR::mermaid(\"\ngraph TB\n\nOOP --> encapsulated_OOP\nOOP --> functional_OOP\n\nfunctional_OOP --> S3\nfunctional_OOP --> S4\n\nencapsulated_OOP --> R6\nencapsulated_OOP --> RC\n\")\n```\n:::\n\n</details>\n\n## Functional OOP in base R\n\n- **S3**\n  - Paradigm: functional OOP\n  - Noteworthy: R's first OOP system\n  - Use case: low-cost solution for common problems\n  - Downsides: no guarantees\n- **S4**\n  - Paradigm: functional OOP\n  - Noteworthy: rewrite of S3, used by `Bioconductor`\n  - Use case: \"more guarantees and greater encapsulation\" than S3\n  - Downsides: higher setup cost than S3\n\n## Encapsulated OOP in base R\n\n- **RC**\n  - Paradigm: encapsulated OOP\n  - Noteworthy: special type of S4 object is mutable--in other words, that can be modified in place (instead of R's usual copy-on-modify behavior)\n  - Use cases: problems that are hard to tackle with functional OOP (in S3 and S4)\n  - Downsides: harder to reason about (because of modify-in-place logic)\n\n## OOP in packages\n\n- **R6**\n  - Paradigm: encapsulated OOP\n  - Noteworthy: resolves issues with RC\n- **S7**\n  - Paradigm: functional OOP\n  - Noteworthy: \n    - best parts of S3 and S4 - ease of S3 with power of S4\n    - Recently adopted in `ggplot2 >= v4.0.0`\n    - See more in [rstudio::conf(2022) talk](https://www.rstudio.com/conference/2022/talks/introduction-to-r7/) and the [S7 website](https://rconsortium.github.io/S7/)\n\n\n## OOP in packages (less well-known)\n\n- **R.oo**\n  - Paradigm: hybrid functional and encapsulated (?)\n- **proto**\n  - Paradigm: prototype OOP\n  - Noteworthy: OOP style used in `ggplot2 < v4.0.0`.\n\n## sloop R package\n\n* **S** **L**anguage **O**bject-**O**riented **P**rogramming\n\n[![Sloop John B ship (left) and Beach Boys album cover (right)](images/base_types/sloop_john_b.png)](https://en.wikipedia.org/wiki/Sloop_John_B)\n\n## Use `sloop::otype` to determine OOP system\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sloop)\notype(1:10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"base\"\n```\n\n\n:::\n\n```{.r .cell-code}\notype(mtcars)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"S3\"\n```\n\n\n:::\n\n```{.r .cell-code}\nmle_obj <- stats4::mle(function(x = 1) (x - 2) ^ 2)\notype(mle_obj)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"S4\"\n```\n\n\n:::\n:::\n\n\n## Everything *is* an object, but not everything is object oriented\n\n![base objects and OO objects are different subsets of objects](images/base_types/oo-venn.png)\n\n## You can use functions to determine if object is base or OOP\n\n- `base::is.object()`: TRUE/FALSE for OOP \n- `sloop::otype()`: gives object type: `\"base\"`, `\"S3\"`, etc.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example 1: a base object\nis.object(1:10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] FALSE\n```\n\n\n:::\n\n```{.r .cell-code}\nsloop::otype(1:10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"base\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# Example 2: an OO object\nis.object(mtcars)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nsloop::otype(mtcars)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"S3\"\n```\n\n\n:::\n:::\n\n\n\n## OO objects have a \"class\" attribute, base objects do not\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# base object has no class attribute\nM <- matrix(1:4, 2)\nattr(M, \"class\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> NULL\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# OO object has one or more classes\nattr(mtcars, \"class\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"data.frame\"\n```\n\n\n:::\n:::\n\n\n\n## Be careful with `class()`\n\n`class()` gives misleading results for base objects.\n\nIt is *not* enough to call `class()` on an object to determine if it is base or OO, as this will return the *implicit class* (rather than `NULL`) when there is no class attribute (i.e. `\"matrix\"`, `\"array\"`, `\"function\"`, `\"numeric\"` or result of `typeof()`):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(1:10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"integer\"\n```\n\n\n:::\n\n```{.r .cell-code}\nclass(M)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"matrix\" \"array\"\n```\n\n\n:::\n:::\n\n\n`sloop::s3_class()` is safer, as it returns the implicit class that the S3 and S4 systems will use to pick methods\n\n\n::: {.cell}\n\n```{.r .cell-code}\ns3_class(M)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"matrix\"  \"integer\" \"numeric\"\n```\n\n\n:::\n:::\n\n\n\n## What about types?\n\nOnly OO objects have a \"class\" attribute, but every object--whether base or OO--has a **base type**\n\nThere are 25 types.\n\nThey are most important in C code, so often see them called by their C type names, e.g. `NILSXP` for `NULL`.\n\n## Type examples\n\n::: {.panel-tabset}\n\n## Vectors\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntypeof(NULL) # NILSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"NULL\"\n```\n\n\n:::\n\n```{.r .cell-code}\ntypeof(c(\"a\", \"b\", \"c\")) # STRSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"character\"\n```\n\n\n:::\n\n```{.r .cell-code}\ntypeof(mtcars) # VECSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"list\"\n```\n\n\n:::\n\n```{.r .cell-code}\ntypeof(1) # REALSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"double\"\n```\n\n\n:::\n\n```{.r .cell-code}\ntypeof(1L) # INTSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"integer\"\n```\n\n\n:::\n\n```{.r .cell-code}\ntypeof(1i) # CPLXSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"complex\"\n```\n\n\n:::\n:::\n\n\n## Functions\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# \"normal\" function\nmy_fun <- function(x) { x + 1 }\ntypeof(my_fun) # CLOSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"closure\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# internal function\ntypeof(`[`) # SPECIALSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"special\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# primitive function\ntypeof(sum) # BUILTINSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"builtin\"\n```\n\n\n:::\n:::\n\n\n## Environments\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntypeof(globalenv()) # ENVSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"environment\"\n```\n\n\n:::\n:::\n\n\n## S4\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmle_obj <- stats4::mle(function(x = 1) (x - 2) ^ 2)\ntypeof(mle_obj) # S4SXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"S4\"\n```\n\n\n:::\n:::\n\n\n## Language components\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntypeof(quote(a)) # SYMSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"symbol\"\n```\n\n\n:::\n\n```{.r .cell-code}\ntypeof(quote(a + 1)) # LANGSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"language\"\n```\n\n\n:::\n\n```{.r .cell-code}\ntypeof(formals(my_fun)) # LISTSXP\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"pairlist\"\n```\n\n\n:::\n:::\n\n\n:::\n\n## Concept Map\n\n![Base types in R](images/base_types/base_types_Sankey_graph.png)\n\n<details>\n<summary>Sankey graph code</summary>\n\nThe graph above was made with [SankeyMATIC](https://sankeymatic.com/)\n\n```\n// toggle \"Show Values\"\n// set Default Flow Colors from \"each flow's Source\"\n\nbase\\ntypes [8] vectors\nbase\\ntypes [3] functions\nbase\\ntypes [1] environments\nbase\\ntypes [1] S4 OOP\nbase\\ntypes [3] language\\ncomponents\nbase\\ntypes [6] C components\n\nvectors [1] NULL\nvectors [1] logical\nvectors [1] integer\nvectors [1] double\nvectors [1] complex\nvectors [1] character\nvectors [1] list\nvectors [1] raw\n\nfunctions [1] closure\nfunctions [1] special\nfunctions [1] builtin\n\nenvironments [1] environment\n\nS4 OOP [1] S4\n\nlanguage\\ncomponents [1] symbol\nlanguage\\ncomponents [1] language\nlanguage\\ncomponents [1] pairlist\n\nC components [1] externalptr\nC components [1] weakref\nC components [1] bytecode\nC components [1] promise\nC components [1] ...\nC components [1] any\n```\n\n</details>\n\n## Be careful about the numeric type\n\nR uses \"numeric\" to mean three slightly different things:\n\n1. Alias for double\n\n2. In S3 and S4, as shorthand for integer or double\n\n3. `is.numeric()` tests for objects that *behave* like numbers \n\nAdvanced R consistently uses numeric to mean an object of type integer or double.\n\n## 1: \"numeric\" is treated as synonymous for double\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create a double and integeger objects\none <- 1\noneL <- 1L\ntypeof(one)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"double\"\n```\n\n\n:::\n\n```{.r .cell-code}\ntypeof(oneL)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"integer\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# check their type after as.numeric()\none |> as.numeric() |> typeof()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"double\"\n```\n\n\n:::\n\n```{.r .cell-code}\noneL |> as.numeric() |> typeof()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"double\"\n```\n\n\n:::\n:::\n\n\n## 2: in S3 and S4 \n\n\"numeric\" is taken as either integer or double, and used when choosing methods:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsloop::s3_class(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"double\"  \"numeric\"\n```\n\n\n:::\n\n```{.r .cell-code}\nsloop::s3_class(1L)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"integer\" \"numeric\"\n```\n\n\n:::\n:::\n\n\n## 3: testing behaviour\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntypeof(factor(\"x\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"integer\"\n```\n\n\n:::\n\n```{.r .cell-code}\nis.numeric(factor(\"x\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] FALSE\n```\n\n\n:::\n:::\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../site_libs/d3-3.3.8/d3.min.js\"></script>\n<script src=\"../site_libs/dagre-0.4.0/dagre-d3.min.js\"></script>\n<link href=\"../site_libs/mermaid-0.3.0/dist/mermaid.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/mermaid-0.3.0/dist/mermaid.slim.min.js\"></script>\n<link href=\"../site_libs/DiagrammeR-styles-0.2/styles.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/chromatography-0.1/chromatography.js\"></script>\n<script src=\"../site_libs/DiagrammeR-binding-1.0.11/DiagrammeR.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}